9151272a-1d36-461c-a269-47d8af3e6ac7:1706387274069:24:S:SELECT\n   BREWERY_NAME\n , PRODUCT_ID AS P_ID\n , PRODUCT_NAME\n , TO_NUMBER(\n      SUBSTR(YR_QTY_STR, 1, INSTR(YR_QTY_STR, ';') - 1)\n   ) AS YR\n , TO_NUMBER(\n      SUBSTR(YR_QTY_STR, INSTR(YR_QTY_STR, ';') + 1)\n   ) AS YR_QTY\nFROM (\n   SELECT\n      BP.BREWERY_NAME\n    , BP.PRODUCT_ID\n    , BP.PRODUCT_NAME\n    , (\n         SELECT YS.YR || ';' || YS.YR_QTY\n         FROM PRACTICAL.YEARLY_SALES YS\n         WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n         ORDER BY YS.YR_QTY DESC\n         FETCH FIRST ROW ONLY\n      ) AS YR_QTY_STR\n   FROM PRACTICAL.BREWERY_PRODUCTS BP\n   WHERE BP.BREWERY_ID = 518\n)\nORDER BY PRODUCT_ID;
5360f3d0-c585-4c47-ba26-6c6c55b8897b:1706388274473:0:S:set pagesize 80
d57edf3c-c2fe-4fcd-be01-615f31ee9f2c:1706388274669:0:S:set linesize 80
30a96898-e4b7-447c-95d1-a416f373d279:1706388274820:0:S:set sqlformat ansiconsole
a719140f-f4bf-425c-ac02-594b415f74b6:1706388275159:20:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , YS.YR\n , YS.YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\nJOIN PRACTICAL.YEARLY_SALES YS\n   ON YS.PRODUCT_ID = BP.PRODUCT_ID\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID, YS.YR;
df564bc2-636a-4fbc-8e26-53ada5d6e204:1706388275593:13:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , (\n      SELECT YS.YR\n      FROM PRACTICAL.YEARLY_SALES YS\n      WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n      ORDER BY YS.YR_QTY DESC\n      FETCH FIRST ROW ONLY\n   ) AS YR\n , (\n      SELECT YS.YR_QTY\n      FROM PRACTICAL.YEARLY_SALES YS\n      WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n      ORDER BY YS.YR_QTY DESC\n      FETCH FIRST ROW ONLY\n   ) AS YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID;
0f55e7a6-6d08-45b7-a109-2e94b5c5655d:1706388275930:13:S:SELECT\n   BREWERY_NAME\n , PRODUCT_ID AS P_ID\n , PRODUCT_NAME\n , TO_NUMBER(\n      SUBSTR(YR_QTY_STR, 1, INSTR(YR_QTY_STR, ';') - 1)\n   ) AS YR\n , TO_NUMBER(\n      SUBSTR(YR_QTY_STR, INSTR(YR_QTY_STR, ';') + 1)\n   ) AS YR_QTY\nFROM (\n   SELECT\n      BP.BREWERY_NAME\n    , BP.PRODUCT_ID\n    , BP.PRODUCT_NAME\n    , (\n         SELECT YS.YR || ';' || YS.YR_QTY\n         FROM PRACTICAL.YEARLY_SALES YS\n         WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n         ORDER BY YS.YR_QTY DESC\n         FETCH FIRST ROW ONLY\n      ) AS YR_QTY_STR\n   FROM PRACTICAL.BREWERY_PRODUCTS BP\n   WHERE BP.BREWERY_ID = 518\n)\nORDER BY PRODUCT_ID;
e87dfa63-91e3-4ef8-a12e-1cb214145f48:1706388276223:0:F:SELECT\n   BREWERY_NAME\n , PRODUCT_ID AS P_ID\n , PRODUCT_NAME\n , YR\n , YR_QTY\nFROM (\n   SELECT\n      BP.BREWERY_NAME\n    , BP.PRODUCT_ID\n    , BP.PRODUCT_NAME\n    , YS.YR\n    , YS.YR_QTY\n    , ROW_NUMBER() OVER (\n         PARTITION BY BP.PRODUCT_ID\n         ORDER BY YS.YR_QTY DESC\n      ) AS RN\n   FROM PRACTICAL.BREWERY_PRODUCTS BP\n   JOIN YEARLY_SALES YS\n      ON YS.PRODUCT_ID = BP.PRODUCT_ID\n   WHERE BP.BREWERY_ID = 518\n)\nWHERE RN = 1\nORDER BY PRODUCT_ID;
332de9ff-edb4-4d98-981a-6a9599341463:1706388276623:14:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , TOP_YS.YR\n , TOP_YS.YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\nCROSS JOIN LATERAL(\n   SELECT\n      YS.YR\n    , YS.YR_QTY\n   FROM PRACTICAL.YEARLY_SALES YS\n   WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n   ORDER BY YS.YR_QTY DESC\n   FETCH FIRST ROW ONLY\n) TOP_YS\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID;
7397b864-1330-4454-8bfe-d9aa83623a59:1706388276873:15:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , TOP_YS.YR\n , TOP_YS.YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\n, LATERAL(\n   SELECT\n      YS.YR\n    , YS.YR_QTY\n   FROM PRACTICAL.YEARLY_SALES YS\n   WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n   ORDER BY YS.YR_QTY DESC\n   FETCH FIRST ROW ONLY\n) TOP_YS\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID;
fc32a904-bd82-4d29-ab56-7469b2aab49f:1706388277146:14:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , TOP_YS.YR\n , TOP_YS.YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\nJOIN LATERAL(\n   SELECT\n      YS.YR\n    , YS.YR_QTY\n   FROM PRACTICAL.YEARLY_SALES YS\n   WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n   ORDER BY YS.YR_QTY DESC\n   FETCH FIRST ROW ONLY\n) TOP_YS\n   ON 1=1\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID;
0aaacd37-8e3a-4209-97e9-55081a40f6be:1706388277390:11:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , TOP_YS.YR\n , TOP_YS.YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\nCROSS APPLY(\n   SELECT\n      YS.YR\n    , YS.YR_QTY\n   FROM PRACTICAL.YEARLY_SALES YS\n   WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n   ORDER BY YS.YR_QTY DESC\n   FETCH FIRST ROW ONLY\n) TOP_YS\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID;
b5eaa126-640e-4af0-b758-d5cb1fb3eadc:1706388277627:11:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , TOP_YS.YR\n , TOP_YS.YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\nOUTER APPLY(\n   SELECT\n      YS.YR\n    , YS.YR_QTY\n   FROM PRACTICAL.YEARLY_SALES YS\n   WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n   AND YS.YR_QTY < 400\n   ORDER BY YS.YR_QTY DESC\n   FETCH FIRST ROW ONLY\n) TOP_YS\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID;
1e667a0f-ed64-42d4-9ec7-6285eb490a67:1706388277889:13:S:SELECT\n   BP.BREWERY_NAME\n , BP.PRODUCT_ID AS P_ID\n , BP.PRODUCT_NAME\n , TOP_YS.YR\n , TOP_YS.YR_QTY\nFROM PRACTICAL.BREWERY_PRODUCTS BP\nLEFT OUTER JOIN LATERAL(\n   SELECT\n      YS.YR\n    , YS.YR_QTY\n   FROM PRACTICAL.YEARLY_SALES YS\n   WHERE YS.PRODUCT_ID = BP.PRODUCT_ID\n   ORDER BY YS.YR_QTY DESC\n   FETCH FIRST ROW ONLY\n) TOP_YS\n   ON TOP_YS.YR_QTY < 500\nWHERE BP.BREWERY_ID = 518\nORDER BY BP.PRODUCT_ID;
